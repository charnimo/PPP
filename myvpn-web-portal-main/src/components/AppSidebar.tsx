import { useNavigate } from "react-router-dom";
import { jwtDecode } from "jwt-decode";

import {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarHeader,
  SidebarMenu,
  SidebarMenuItem,
  SidebarMenuButton,
  SidebarGroup,
  SidebarGroupContent,
  SidebarGroupLabel,
} from "@/components/ui/sidebar";

import { 
  Home, 
  Globe, 
  Settings, 
  User, 
  Shield, 
  HelpCircle, 
  LogOut 
} from "lucide-react";

export function AppSidebar() {
  const navigate = useNavigate();

  const authToken = localStorage.getItem("authToken");

  let userRole = null;
  if (authToken) {
    try {
      const decoded: any = jwtDecode(authToken);
      userRole = decoded?.role || null;
    } catch (error) {
      console.error("Failed to decode JWT:", error);
    }
  }

  const mainMenuItems = [
    {
      title: "Dashboard",
      icon: Home,
      path: "/"
    },
    {
      title: "Servers",
      icon: Globe,
      path: "/servers"
    },
    {
      title: "Settings",
      icon: Settings,
      path: "/settings"
    },
    {
      title: "Account",
      icon: User,
      path: "/account"
    },
    ...(userRole === "admin"
      ? [
          {
            title: "Admin",
            icon: User,
            path: "/admin"
          }
        ]
      : [])
  ];

  const supportMenuItems = [
    {
      title: "Help Center",
      icon: HelpCircle,
      path: "/help"
    }
  ];

  return (
    <Sidebar>
      <SidebarHeader className="px-6 py-4 flex items-center">
        <svg version="1.1" id="Layer_1" x="0px" y="0px"
	 width="100%" viewBox="0 0 1024 1024" enable-background="new 0 0 1024 1024"  className="h-14 w-15 text-sidebar-foreground mr-2 tracking-tight ">
<path fill="#FFFFFF" opacity="1.000000" stroke="none" 
	d="
M575.446411,752.392090 
	C564.814209,773.745483 554.939941,795.102661 541.679626,814.585205 
	C527.099426,836.007019 510.089691,854.951050 486.892395,867.557556 
	C475.915833,873.522705 464.272064,877.166626 452.016113,879.109009 
	C451.035248,879.264465 450.020020,879.400513 449.151703,878.625183 
	C448.724152,876.916138 450.184601,876.358521 451.123322,875.524536 
	C462.924683,865.038208 468.551117,851.541992 470.736694,836.202820 
	C474.303009,811.173340 466.456635,788.473572 456.528473,766.281982 
	C441.958557,733.715210 424.664032,702.541443 407.181793,671.478149 
	C399.993256,658.705200 392.760315,645.956909 385.466064,633.244080 
	C382.007629,627.216614 379.908997,627.105286 375.613617,632.449463 
	C362.780701,648.415710 349.952148,664.385437 337.110596,680.344727 
	C336.189056,681.489990 335.395569,682.811218 333.498077,683.434021 
	C331.399353,677.938904 333.347046,672.599731 333.988556,667.380310 
	C337.480042,638.973145 343.014801,610.956238 350.807068,583.401550 
	C351.265320,581.781067 351.948090,580.184631 350.061798,578.954041 
	C348.260132,577.778625 346.886444,578.903381 345.495941,579.775208 
	C328.137726,590.658997 310.784790,601.551270 293.439331,612.455383 
	C282.157532,619.547485 270.908203,626.691528 259.594116,633.731689 
	C258.122589,634.647400 256.726562,636.035889 254.302490,635.722168 
	C254.414993,633.360535 256.046478,631.833069 257.172577,630.156006 
	C280.633148,595.215149 301.414612,558.819153 316.878296,519.575623 
	C325.104950,498.698059 329.714081,477.081940 330.947784,454.560822 
	C331.988220,435.566986 330.754395,416.580750 331.773895,397.639679 
	C333.923615,357.699768 341.206207,319.083069 362.664734,284.326904 
	C374.960083,264.412262 391.632751,248.760513 410.065125,234.791260 
	C428.520813,220.804352 447.236328,207.157959 465.598480,193.050613 
	C481.439270,180.880417 497.273743,168.642822 510.216217,153.195786 
	C511.049286,152.201508 512.121460,151.407562 513.087219,150.515976 
	C516.227600,151.591919 517.368530,154.404343 519.120117,156.493896 
	C534.903748,175.323593 554.583069,189.688889 573.953247,204.386093 
	C590.938171,217.273422 608.429138,229.475922 625.191162,242.677490 
	C659.445923,269.656067 679.192078,305.159790 688.445190,347.301331 
	C694.813904,376.306519 696.226685,405.632965 695.207336,435.094543 
	C693.856140,474.149719 703.747375,510.488007 719.882202,545.559021 
	C734.404480,577.124878 751.495361,607.178284 771.977234,635.274536 
	C772.143616,635.502808 772.078247,635.900085 772.305725,637.591248 
	C738.937012,616.856995 706.312622,596.585266 673.688232,576.313477 
	C673.328857,576.565796 672.969421,576.818054 672.610046,577.070374 
	C682.947693,612.120483 690.209351,647.727783 693.124207,684.156555 
	C690.553589,684.813904 689.884888,682.893738 688.952576,681.737610 
	C675.985779,665.658936 663.081604,649.529846 650.162598,633.412720 
	C649.433533,632.503113 648.760437,631.542603 647.972778,630.687256 
	C644.614441,627.040527 642.819519,627.116455 640.384705,631.467041 
	C630.951355,648.322998 621.443298,665.141785 612.329529,682.170593 
	C599.912537,705.371216 587.830688,728.751221 575.446411,752.392090 
M605.674744,458.188812 
	C615.445801,453.933105 623.046753,446.942383 628.898560,438.305420 
	C642.441895,418.316162 647.842224,395.287262 652.605469,372.094055 
	C652.930725,370.510437 653.068359,368.559052 651.257141,367.635925 
	C649.282166,366.629333 647.814270,368.108978 646.323059,369.143707 
	C623.488647,384.987396 600.638611,400.808533 577.825195,416.682343 
	C566.759583,424.381836 555.693726,432.084534 544.767334,439.978729 
	C540.276489,443.223328 539.981201,445.539459 543.645691,448.219452 
	C562.333801,461.886871 582.431335,467.688446 605.674744,458.188812 
M458.485840,424.059723 
	C432.957062,406.204071 407.432007,388.343079 381.890076,370.506287 
	C380.393005,369.460785 378.842010,368.412842 377.170074,367.716675 
	C374.851776,366.751343 373.089935,367.066986 373.727234,370.282715 
	C377.912872,391.403473 383.251404,412.189362 393.496948,431.305359 
	C400.949036,445.209229 411.050476,456.508392 426.993866,460.828949 
	C448.251923,466.589691 466.657715,459.889435 483.588470,447.325500 
	C486.821808,444.926117 485.449341,442.889679 482.834442,441.067139 
	C474.908173,435.542572 466.993622,430.001251 458.485840,424.059723 
z"/>
</svg>
        <span className="text-3xl font-bold text-sidebar-foreground">GhostRoute</span>
      </SidebarHeader>

      <SidebarContent>
        <SidebarGroup>
          <SidebarGroupLabel>Main</SidebarGroupLabel>
          <SidebarGroupContent>
            <SidebarMenu>
              {mainMenuItems.map((item) => (
                <SidebarMenuItem key={item.path}>
                  <SidebarMenuButton onClick={() => navigate(item.path)}>
                    <item.icon className="h-5 w-5 mr-3" />
                    <span>{item.title}</span>
                  </SidebarMenuButton>
                </SidebarMenuItem>
              ))}
            </SidebarMenu>
          </SidebarGroupContent>
        </SidebarGroup>

        <SidebarGroup>
          <SidebarGroupLabel>Support</SidebarGroupLabel>
          <SidebarGroupContent>
            <SidebarMenu>
              {supportMenuItems.map((item) => (
                <SidebarMenuItem key={item.path}>
                  <SidebarMenuButton onClick={() => navigate(item.path)}>
                    <item.icon className="h-5 w-5 mr-3" />
                    <span>{item.title}</span>
                  </SidebarMenuButton>
                </SidebarMenuItem>
              ))}
            </SidebarMenu>
          </SidebarGroupContent>
        </SidebarGroup>
      </SidebarContent>

      <SidebarFooter>
        <SidebarMenu>
          <SidebarMenuItem>
            <SidebarMenuButton
              onClick={() => {
                localStorage.removeItem("authToken");
                navigate("/");
              }}
            >
              <LogOut className="h-5 w-5 mr-3" />
              <span>Logout</span>
            </SidebarMenuButton>
          </SidebarMenuItem>
        </SidebarMenu>
      </SidebarFooter>
    </Sidebar>
  );
}

export default AppSidebar;
